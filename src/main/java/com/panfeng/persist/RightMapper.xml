<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.panfeng.persist.RightMapper">
	
	<select id="all" resultType="Right">
		<![CDATA[
			SELECT r.RIGHTID,
				   r.RIGHTNAME,
				   r.URL,
				   r.RIGHTDESCRIPTION,
				   r.ICON,
				   r.PID,
				   r.SEQ,
				   r.status,
				   r.RESOURCETYPE,
				   r.POS,
				   r.CODE,
				   r.ISCOMMON,
				   DATE_FORMAT(r.UPDATEDATE,'%Y-%m-%d') AS updateDate
			FROM RIGHTS r
		]]>
	</select>

	<select id="listWithPagination" resultType="Right">
		<![CDATA[
			SELECT r.RIGHTID,
				   r.RIGHTNAME,
				   r.URL,
				   r.RIGHTDESCRIPTION,
				   r.ICON,
				   r.PID,
				   r.SEQ,
				   r.status,
				   r.RESOURCETYPE,
				   r.POS,
				   r.CODE,
				   r.ISCOMMON,
				   DATE_FORMAT(r.UPDATEDATE,'%Y-%m-%d') AS updateDate
			FROM RIGHTS r
		]]>
		<![CDATA[
			ORDER BY r.seq
			LIMIT ${begin} , ${limit}
		]]>
	</select>
	
	<select id="getRights" resultType="Right">
		<![CDATA[
			SELECT r.RIGHTID,
				   r.RIGHTNAME,
				   r.URL,
				   r.RIGHTDESCRIPTION,
				   r.ICON,
				   r.PID,
				   r.SEQ,
				   r.status,
				   r.RESOURCETYPE,
				   r.POS,
				   r.CODE,
				   r.ISCOMMON,
				   DATE_FORMAT(r.UPDATEDATE,'%Y-%m-%d') AS updateDate
				FROM RIGHTS r
			WHERE r.URL <> '' 
				ORDER BY r.SEQ ASC
		]]>
	</select>
	
	<select id="findRightById" resultType="Right">
		<![CDATA[
			SELECT r.RIGHTID,
				   r.RIGHTNAME,
				   r.URL,
				   r.RIGHTDESCRIPTION,
				   r.ICON,
				   r.PID,
				   r.SEQ,
				   r.status,
				   r.RESOURCETYPE,
				   r.POS,
				   r.CODE,
				   r.ISCOMMON,
				   DATE_FORMAT(r.UPDATEDATE,'%Y-%m-%d') AS updateDate
			FROM RIGHTS r
			WHERE 1 = 1 
				AND r.RIGHTID = ${rightId}
		]]>
	</select>
	
	<select id="findRightByPid" resultType="Right">
		<![CDATA[
			SELECT DISTINCT r.RIGHTID,
				   r.RIGHTNAME,
				   r.URL,
				   r.RIGHTDESCRIPTION,
				   r.ICON,
				   r.PID,
				   r.SEQ,
				   r.status,
				   r.RESOURCETYPE,
				   r.POS,
				   r.CODE
			FROM RIGHTS r
			WHERE 1 = 1
		]]>
		<if test="pList != null">
			<![CDATA[
				AND r.RIGHTID IN
			]]>
			<foreach collection="pList" open="(" close=")" item="pId"
				separator=",">
				${pId}
		</foreach>
		</if>
	</select>
	
	<select id="getAllRightsWithMenu" resultType="Right">
		<![CDATA[
			SELECT DISTINCT r.RIGHTID,
				   r.RIGHTNAME,
				   r.URL,
				   r.RIGHTDESCRIPTION,
				   r.ICON,
				   r.PID,
				   r.SEQ,
				   r.status,
				   r.RESOURCETYPE,
				   r.POS,
				   r.CODE
			FROM RIGHTS r
			WHERE 1 = 1
				AND r.RESOURCETYPE = 0
		]]>
	</select>

	<insert id="save" useGeneratedKeys="true" keyProperty="rightId"
		parameterType="Right">
		<![CDATA[
			INSERT INTO RIGHTS(
				RIGHTNAME,
   				URL,
   				RIGHTDESCRIPTION,
   				ICON,
   				PID,
   				SEQ,
   				status,
   				RESOURCETYPE,
   				POS,
   				CODE,
   				ISCOMMON
   			) VALUES (
				#{rightName},
				#{url},
				#{rightDescription},
				#{icon},
				#{pId},
				${seq},
				${status},
				${resourceType},
				${pos},
				${code},
				${isCommon}
			)
		]]>
	</insert>
	
	<select id="maxSize" resultType="java.lang.Long">
		<![CDATA[
			SELECT COUNT(1)
				FROM RIGHTS
		]]>
	</select>
	
	<update id="update">
		<![CDATA[
			UPDATE RIGHTS
				SET RIGHTNAME = #{rightName},
   				URL = #{url},
   				RIGHTDESCRIPTION = #{rightDescription},
   				ICON = #{icon},
   				PID = #{pId},
   				SEQ = ${seq},
   				status = ${status},
   				RESOURCETYPE = ${resourceType},
   				ISCOMMON = ${isCommon},
				UPDATEDATE = CURRENT_TIMESTAMP
			WHERE RIGHTID = ${rightId}
		]]>
	</update>
	
	<delete id="delete">
		<![CDATA[
			DELETE FROM RIGHTS
				WHERE RIGHTID = ${rightId}
		]]>
	</delete>
	
	<delete id="deleteRightRoleLink">
		<![CDATA[
			DELETE FROM ROLE_RIGHT
				WHERE RIGHTID = ${rightId}
		]]>
	</delete>
	
	<select id="findMaxPos" resultType="java.lang.Integer">
		<![CDATA[
			SELECT MAX(r.POS)
				FROM RIGHTS r
		]]>
	</select>
	
	<select id="findMaxCodeByPos" resultType="java.lang.Long">
		<![CDATA[
			SELECT MAX(r.CODE)
				FROM RIGHTS r
			WHERE r.POS = ${pos}
		]]>
	</select>
</mapper>
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.panfeng.persist.FinanceMapper">

	<select id="listWithPagination" resultType="DealLog">
		<![CDATA[
			SELECT 
				dl.DL_BILLNO AS billNo,
				DATE_FORMAT(dl.DL_CREATETIME,'%Y-%m-%d %T') AS createTime,
				dl.DL_DEAL_LOG_SOURCE AS dealLogSource,
				dl.DL_DEAL_STATUS AS dealStatus,
				dl.DL_DESCRIPTION AS description,
				dl.DL_ID AS dealId,
				dl.DL_LOG_TYPE AS description,
				dl.DL_PAY_CHANNEL AS payChannel,
				dl.DL_PAY_PRICE AS payPrice,
				dl.DL_PROJECT_ID AS projectId,
				dl.DL_PROJECT_NAME AS projectName,
				DATE_FORMAT(dl.DL_UPDATETIME,'%Y-%m-%d %T') AS updateTime,
				dl.DL_USER_ID AS userId,
				dl.DL_USER_TYPR AS userType,
				dl.DL_USER_NAME AS userName,
				dl.DL_UN_ORDERID  AS unOrderId,
				dl.DL_PAYTIME ASã€€payTime
			FROM DEAL_LOG dl
			WHERE 1 = 1
		]]>
		<if test="logType != null and logType != ''">
			AND dl.DL_LOG_TYPE = ${logType}
		</if>
	</select>
	
	<select id="maxSize" resultType="Long">
		<![CDATA[
			SELECT 
				count(1)
			FROM DEAL_LOG dl
			WHERE 1 = 1
		]]>
		<if test="logType != null and logType != ''">
			AND dl.DL_LOG_TYPE = ${logType}
		</if>
	</select>
	
	<select id="update" resultType="Long">
		<![CDATA[
			UPDATE DEAL_LOG SET  
		]]>
		<if test="billNo != null and billNo != '' ">
			DL_BILLNO = #{billNo},
		</if>
		<if test="payChannel != null and payChannel != '' ">
			DL_PAY_CHANNEL = #{payChannel},
		</if>
		<if test="dealStatus != null ">
			DL_DEAL_STATUS = ${dealStatus},
		</if>
		<if test="userType != null and userType != '' ">
			DL_USER_TYPR = #{userType},
		</if>
		<if test="userId != null ">
			DL_USER_ID = ${userId},
		</if>
		<if test="dealLogSource != null ">
			DL_DEAL_LOG_SOURCE = ${dealLogSource},
		</if>
		<if test="logType != null ">
			DL_LOG_TYPE = ${logType},
		</if>
		<if test="projectName != null and projectName != '' ">
			DL_PROJECT_NAME = #{projectName},
		</if>
		<if test="projectId != null ">
			DL_PROJECT_ID = ${projectId},
		</if>
		<if test="userName != null and userName != '' ">
			DL_USER_NAME = #{userName},
		</if>
		<if test="payPrice != null ">
			DL_PAY_PRICE = ${payPrice},
		</if>
		<if test="description != null and description != '' ">
			DL_DESCRIPTION = #{description},
		</if>
		<if test="unOrderId != null and unOrderId != '' ">
			DL_UN_ORDERID = #{unOrderId},
		</if>
		<if test="payTime != null and payTime != '' ">
			DL_PAYTIME = DATE_FORMAT(#{payTime},'%Y-%m-%d %T'),
		</if>
		<![CDATA[
			DL_UPDATETIME = CURRENT_TIMESTAMP 
			 WHERE DL_ID = ${dealId}
		]]>
	</select>
	
	<select id="deleteByArray" resultType="Long">
		<![CDATA[
			DELETE FROM DEAL_LOG
				WHERE DL_ID = -1
				
		]]>
		<if test="ids != null and ids != ''">
			<![CDATA[
				OR DL_ID IN
			]]>
			<foreach collection="ids" open="(" close=")" item="id"
				separator=",">
				${id}
			</foreach>
		</if>
	</select>

</mapper>
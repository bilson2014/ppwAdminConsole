<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.panfeng.persist.ItemMapper">
	<select id="listWithPagination" resultType="Item">
		<![CDATA[
			SELECT i.ITEMID AS itemId,
				   i.ITEMNAME AS itemName,
				   i.ITEMDESCRIPTION AS itemDescription,
				   DATE_FORMAT(i.CREATEDATE,'%Y-%m-%d %T') AS createDate,
				   i.OD AS od,
				   ISACTIVE AS isActive
			FROM ITEM i
			WHERE 1 = 1
		]]>
		<if test="itemId != null and itemId != ''">
			AND i.ITEMID = ${itemId}
		</if>
		<![CDATA[
			ORDER BY i.OD,i.ITEMID
			LIMIT ${begin} , ${limit}
		]]>
	</select>

	<select id="list" resultType="Item">
		<![CDATA[
			SELECT i.ITEMID AS itemId,
				   i.ITEMNAME AS itemName,
				   i.ITEMDESCRIPTION AS itemDescription,
				   DATE_FORMAT(i.CREATEDATE,'%Y-%m-%d %T') AS createDate,
				   i.OD AS od
			FROM ITEM i
		]]>
	</select>

	<select id="maxSize" resultType="long">
		<![CDATA[
			SELECT COUNT(1)
				FROM ITEM i
			WHERE 1 = 1
		]]>
		<if test="itemId != null and itemId != ''">
			AND i.ITEMID = ${itemId}
		</if>
	</select>

	<insert id="save">
		<![CDATA[
			INSERT INTO ITEM(
				ITEMNAME,
				ITEMDESCRIPTION,
				OD,
				ISACTIVE
			) VALUES(
				#{itemName},
				#{itemDescription},
				${od},
				${isActive}
			)
		]]>
	</insert>

	<update id="update">
		<![CDATA[
			UPDATE ITEM
				SET ITEMNAME = #{itemName},
					ITEMDESCRIPTION = #{itemDescription},
					OD = ${od},
					ISACTIVE = ${isActive},
					UPDATEDATE = CURRENT_TIMESTAMP
			WHERE ITEMID = ${itemId}
		]]>
	</update>

	<delete id="delete">
		<![CDATA[
			DELETE FROM ITEM
				WHERE ITEMID = ${itemId}
		]]>
	</delete>

	<select id="listWithoutActive" resultType="Item">
		<![CDATA[
			SELECT i.ITEMID AS itemId,
				   i.ITEMNAME AS itemName,
				   i.ITEMDESCRIPTION AS itemDescription,
				   DATE_FORMAT(i.CREATEDATE,'%Y-%m-%d %T') AS createDate,
				   i.OD AS od
			FROM ITEM i
			WHERE 1 = 1
				AND isActive = 0 
		]]>
	</select>

	<select id="getTagsById" resultType="Item">
		<![CDATA[
			SELECT i.ITEMID AS itemId,
				   i.ITEMNAME AS itemName,
				   i.ITEMDESCRIPTION AS itemDescription,
				   DATE_FORMAT(i.CREATEDATE,'%Y-%m-%d %T') AS createDate,
				   i.OD AS od
			FROM ITEM i
			WHERE ITEMID IN 
		]]>
		<foreach collection="ids" item="bus" separator="," open="("
			close=")">
			#{bus}
		</foreach>
	</select>
</mapper>